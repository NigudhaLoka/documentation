# Legacy "Anonymous" Application Documentation

**Status:** Archived (Circa 2020)
**Type:** Legacy System

## 1. Introduction

This document provides an overview of the "Anonymous" application, a PHP and MySQL-based platform developed around 2020. Its primary function was to allow users to post questions (referred to as "events") and receive replies, with an option for anonymity.

This application serves as the predecessor to the new "NigūḍhaLoka" platform. Understanding its architecture, features, and data model provides context for the evolution and design decisions made for NigūḍhaLoka.

The codebase for this legacy system can be found in the archived repositories within the 'NigudhaLoka' GitHub organization (e.g., `Anonymous`, `anonymous.service-worker`).

## 2. Core Functionality

The "Anonymous" application provided the following key features:

* **User Authentication:**
    * User registration with username, display name, email, and phone number.
    * User login using username and password.
    * Email verification was introduced in later API versions (v2 onwards).
    * Password reset functionality.
* **Event (Question/Topic) Management:**
    * Authenticated users could create "events" (questions or topics).
    * View existing events and their details.
    * Update and delete events created by the user.
    * Disable events (presumably by an admin or creator).
* **Replies:**
    * Users could reply to existing events.
    * Option to post replies anonymously, where the user's registered identity was not displayed with the message.
    * Even for anonymous replies, IP address and session ID were logged.
    * Replies were paginated.
* **Captcha Verification:**
    * Implemented to prevent spam/bot activity during registration, event creation/update, password changes, and feedback submissions.
* **Profile Management:**
    * Users could view and update their display name, email, and phone number.
* **Notifications:**
    * Basic email notification system (e.g., welcome email, verification email).
    * Evidence of a service worker and potential PWA features for push notifications (though integration details might vary).

## 3. Technology Stack

* **Backend:** PHP (structured with API versioning: v1, v2, v3)
* **Database:**
    * **MySQL:** Primary database for core user data, events, replies, captcha information, and login tracking.
        * `anonymous_users`
        * `anonymous_events`
        * `anonymous_replies`
        * `anonymous_captcha`
        * `anonymous_login_information`
    * **MongoDB:** Introduced in later API versions (v2/v3), primarily used by the `Mail` class for storing mail-related data or logs.
* **Frontend:** Primarily server-side rendered HTML generated by PHP scripts located in the `components` directory. JavaScript was used for client-side interactions. The "ecobit" theme/template was used for some UI components.
* **Session Management:** PHP's native session handling (`$_SESSION`).
* **Web Server Environment:** (Assumed) Standard PHP hosting environment (e.g., Apache/Nginx with PHP module).

## 4. Code Structure & Patterns

* **API-centric Design:** The core logic was exposed through a set of PHP-based APIs, versioned into `api/v1/`, `api/v2/`, and `api/v3/`. Each version had its own `index.php` router.
* **Modular Classes:** Object-Oriented Programming (OOP) was used to an extent, with classes for key entities:
    * `Authentication` (and `Authentication_V2` extending it)
    * `Event` (and `Event_V2` extending it)
    * `Mail` (evolving across versions)
* **Component-Based UI (Server-Side):** The `components/` directory housed PHP files responsible for generating HTML snippets for different parts of the user interface (e.g., login form, event display).
* **Cron Jobs:** The `crons/` directory contained PHP scripts for scheduled background tasks such as:
    * `clean_captcha.php`: Cleaning up used or expired captcha entries.
    * `email_notification.php` & `fetch_notifications.php`: Handling email notifications.
    * `sendEmailVerification.php`: Sending email verification links.
* **Helper Utilities:** Various helper functions for tasks like generating random strings, IP address retrieval, etc.

## 5. Data Model Overview (MySQL)

* **`anonymous_users`**: Stored user registration details (`uid`, `username`, `email`, `phoneNumber`, `displayName`, `password` (MD5 hashed), verification status).
* **`anonymous_events`**: Stored topics/questions (`id`, `link` (unique event identifier), `uid` (creator), `context` (the actual question), `disabled`, `deleted` flags).
* **`anonymous_replies`**: Stored replies to events (`event_id`, `uid` (if not anonymous), `name` (display name for reply), `message`, `ip_address`, `session_id`, `anonymous` flag).
* **`anonymous_captcha`**: Stored captcha codes, session IDs, and usage status.
* **`anonymous_login_information`**: Tracked user login activity and notification counts.

## 6. Security Aspects (Legacy)

* **Password Hashing:** Used MD5 with a static salt (`Developers@Work`), which is considered insecure by modern standards.
* **SQL Injection:** Basic protection via `str_replace("'","\'",$data["context"])` was used, which is not a robust defense against SQL injection. Parameterized queries were not consistently used.
* **Session Management:** Relied on PHP's built-in session mechanism. Session hijacking or fixation could be potential concerns depending on the server configuration.
* **Captcha:** Provided a layer of defense against automated submissions.
* **IP Logging:** IP addresses were logged for replies, which could be a privacy concern if not handled correctly, despite the "anonymous" nature of posts.

## 7. Noteworthy Points & Observations

* **Iterative API Development:** The presence of `v1`, `v2`, and `v3` APIs indicates an iterative development approach, with features like email verification and MongoDB integration for mail appearing in later versions.
* **Service Worker:** A `serviceWorker.js` file and related entries in the Postman collection (pointing to a Heroku app for notifications) suggest an attempt at Progressive Web App (PWA) features, likely for push notifications.
* **Frontend Components:** The UI was heavily reliant on PHP to generate HTML, with JavaScript for dynamic behavior. The `ecobit` theme appears to have been used for styling.
* **Database Configuration:** Database credentials were often hardcoded within the API version's `index.php` files.

This legacy system, despite its limitations by today's standards, laid the groundwork for the core concept of anonymous discussions that NigūḍhaLoka aims to enhance significantly.
