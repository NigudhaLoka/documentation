# Legacy: Anonymous Service Worker - Database Schema (MongoDB)

**Status: Deprecated**

This document outlines the MongoDB database schema used by the legacy `anonymous.service-worker`. This service is part of the old "Anonymous" application and is being replaced by the "NigūḍhaLoka" platform.

The service connected to a MongoDB database named "anonymous".


## Collections

### 1. `device_notifications`

This collection stored information related to web push notification subscriptions for devices.


* **`_id`**: `String`
    * Description: A unique identifier for the document, composed of the subscription endpoint and the user ID (`subscription.endpoint + "_" + uid`). This served as the primary key.
       
    * Example: `"https://fcm.googleapis.com/fcm/send/some_unique_token_123_some_user_id"`
* **`subscription`**: `Object`
    * Description: The push subscription object generated by the client's browser, conforming to the Web Push API standard. This object contains the endpoint URL and the necessary keys for sending a push message.
       
    * Example:
        ```json
        {
          "endpoint": "[https://fcm.googleapis.com/fcm/send/some_unique_token](https://fcm.googleapis.com/fcm/send/some_unique_token)",
          "expirationTime": null,
          "keys": {
            "p256dh": "some_p256dh_key",
            "auth": "some_auth_key"
          }
        }
        ```
* **`uid`**: `String`
    * Description: The user identifier associated with this push notification subscription. This linked the subscription to a user in the main "Anonymous" application.
       
    * Example: `"some_user_id"`
* **`lastActive`**: `Date`
    * Description: A timestamp indicating the last time this subscription was recorded or updated. Used by the cleanup cron job to remove stale subscriptions.
       
    * Example: `ISODate("2020-01-15T10:00:00Z")`

### 2. `mails`

This collection appeared to handle some form of mail or message data. Its exact purpose within the broader "Anonymous" application is not fully detailed in the service worker code, but it was subject to a cleanup routine.


* **`used`**: `Boolean`
    * Description: A flag that likely indicated whether the mail/message entry has been processed or is no longer active. Entries with `used: true` were targeted by the cleanup cron job.
       
* **`timestamp`**: `Date`
    * Description: A timestamp associated with the mail/message entry. Entries older than 30 days were targeted by the cleanup cron job.
       

*Other fields in the `mails` collection are not specified in the `anonymous.service-worker/index.js` file.*

## Notes

* The schema is inferred from the usage within the `anonymous.service-worker/index.js` file.
* The primary function related to these collections in the service worker was for push notifications and data cleanup.
